= Plugin: Auth
Martin Langlotz <martin.langlotz@evilbrain.de>
:source-highlighter: highlightjs
:toc:
:icons: font

This plugin

- Authenticate a user with an local auth-file.
- passwords for users are stored with bcrypt.
- auth-file is stored in provided config-path

== Watch for file changes

Change to the auth-file are detected during runtime.

You can add a new user to the file and the password will be automatically crypted with bcrypt. The user will be immediately active

Also the cleartext-password will be deleted

=== Global Options

[cols="1,1,1", options="header", width="100%"] 
.Global options
|===
| Option
| Type
| Description

| anonym
| bool
a|
If set to `true`, you can login without username and password

|===


=== Structure for the new user

```yaml
new:
  - username: ANewUser
    password: cleartextpassword
```

== Topics

You can interact with this plugin also over mqtt itselfe :)

Here are the topics this plugin will handle

[cols="5,1,1,1,3", options="header", width="100%"] 
.Topics
|===
| Topic
| Payload
| Payload example
| Direction
| Description

| $SYS/auth/user/whoami
| -
| -
| publish
| Request the current username

| $SYS/auth/user/name
| username
| john
| subscribe
| The current loggedin user

| $SYS/auth/users/list
| any
| true
| publish
| Request a list of known users

| $SYS/auth/users/list/json
| json
a|
```json
[
  { username: "<username>" } 
]
```
| subscribe
| The list of known users

| $SYS/auth/user/<username>/password/set
| cleartext-password
| mycreazypassword0815
| publish
a|
 - will set a password for an existing user
 - create a new user if not exist

| $SYS/auth/user/<username>/password/set/ok
| true or false
| true
| subscribe
| Infor that a new password was succsessfully saved

| $SYS/auth/user/<username>/delete
| -
| -
| publish
| Delete an user

| $SYS/auth/user/<username>/delete/ok
| -
| -
| subscribe
| If the user was correctly deleted

|===
